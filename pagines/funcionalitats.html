<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3 funcionalitats JS - Web ITB</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/reset.css">
</head>
<body>

    <header class="navbar">

        <div class="logo-text">JS FUNCTIONALITIES</div>
        <nav class="header-buttons">
            <a href="../llista_projectes.html" class="btn btn-blue">Home</a>
            <a href="../index.html" class="btn btn-blue">featured projects</a>
            <a href="formulari.html" class="btn btn-blue">Contact Form</a>
            <a href="funcionalitats.html" class="btn btn-dark">3 JS Functionalities</a>
        </nav>
    </header>

    <div class="container" style="margin-top: 30px;">

        <div class="detail-header">
            EFFECTS COLLECTION (MIX)
        </div>

        <div class="detail-subheader">
            3D Sphere, Fireworks, and the original Nebula.
        </div>

        <div class="wireframe-box js-box" id="box1">
            <div class="instruction-text">1. Cybernetic Sphere (Move mouse)</div>
            <canvas id="canvasSphere"></canvas>
        </div>

        <div class="wireframe-box js-box" id="box2" style="cursor: crosshair;">
            <div class="instruction-text">2. Fireworks (CLICK!)</div>
            <canvas id="canvasFireworks"></canvas>
        </div>

        <div class="wireframe-box js-box" id="box3">
            <div class="instruction-text">3. Neon Nebula (Move mouse)</div>
            <canvas id="canvasNebula"></canvas>
        </div>

        <footer class="footer-box">
            2025/26 Students : Biel y Ramiro
        </footer>

    </div>

    <script>
        // =========================================================
        // 1. ESFERA 3D ROTATORIA
        // =========================================================
        const cvsSphere = document.getElementById('canvasSphere');
        const ctxSphere = cvsSphere.getContext('2d');

        function resizeSphere() {
            cvsSphere.width = cvsSphere.parentElement.offsetWidth;
            cvsSphere.height = cvsSphere.parentElement.offsetHeight;
        }
        resizeSphere();

        let sphereMouseX = 0;
        let sphereMouseY = 0;

        cvsSphere.addEventListener('mousemove', (e) => {
            const rect = cvsSphere.getBoundingClientRect();
            sphereMouseX = (e.clientX - rect.left - cvsSphere.width/2) * 0.001;
            sphereMouseY = (e.clientY - rect.top - cvsSphere.height/2) * 0.001;
        });

        function animateSphere() {
            ctxSphere.fillStyle = 'rgba(0,0,0,0.2)';
            ctxSphere.fillRect(0, 0, cvsSphere.width, cvsSphere.height);

            const time = Date.now() * 0.001;
            const cx = cvsSphere.width / 2;
            const cy = cvsSphere.height / 2;
            const radius = 120;

            let rotX = time * 0.5 + sphereMouseY * 2;
            let rotY = time * 0.3 + sphereMouseX * 2;

            for (let i = 0; i < 300; i++) {
                const phi = Math.acos(-1 + (2 * i) / 300);
                const theta = Math.sqrt(300 * Math.PI) * phi;

                let x = radius * Math.cos(theta) * Math.sin(phi);
                let y = radius * Math.sin(theta) * Math.sin(phi);
                let z = radius * Math.cos(phi);

                let tempX = x * Math.cos(rotY) - z * Math.sin(rotY);
                let tempZ = x * Math.sin(rotY) + z * Math.cos(rotY);
                x = tempX; z = tempZ;

                let tempY = y * Math.cos(rotX) - z * Math.sin(rotX);
                z = y * Math.sin(rotX) + z * Math.cos(rotX);
                y = tempY;

                let scale = 300 / (300 + z);
                let px = cx + x * scale;
                let py = cy + y * scale;
                let size = 2 * scale;

                ctxSphere.beginPath();
                ctxSphere.arc(px, py, size, 0, Math.PI * 2);
                ctxSphere.fillStyle = `hsl(${i + time * 50}, 100%, 60%)`;
                ctxSphere.fill();
            }
            requestAnimationFrame(animateSphere);
        }
        animateSphere();


        // =========================================================
        // 2. FUEGOS ARTIFICIALES
        // =========================================================
        const cvsFire = document.getElementById('canvasFireworks');
        const ctxFire = cvsFire.getContext('2d');

        function resizeFire() {
            cvsFire.width = cvsFire.parentElement.offsetWidth;
            cvsFire.height = cvsFire.parentElement.offsetHeight;
        }
        resizeFire();

        let particlesFire = [];

        cvsFire.addEventListener('click', (e) => {
            const rect = cvsFire.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            createExplosion(x, y);
        });

        function createExplosion(x, y) {
            const color = `hsl(${Math.random() * 360}, 100%, 50%)`;
            for (let i = 0; i < 50; i++) {
                particlesFire.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    alpha: 1,
                    color: color
                });
            }
        }

        function animateFire() {
            ctxFire.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctxFire.fillRect(0, 0, cvsFire.width, cvsFire.height);

            for (let i = 0; i < particlesFire.length; i++) {
                let p = particlesFire[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.15; // Gravedad
                p.alpha -= 0.02;

                ctxFire.globalAlpha = p.alpha;
                ctxFire.fillStyle = p.color;
                ctxFire.beginPath();
                ctxFire.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctxFire.fill();

                if (p.alpha <= 0) {
                    particlesFire.splice(i, 1);
                    i--;
                }
            }
            ctxFire.globalAlpha = 1;
            requestAnimationFrame(animateFire);
        }
        animateFire();


        // =========================================================
        // 3. NEBULOSA
        // =========================================================
        const cvsNeb = document.getElementById('canvasNebula');
        const ctxNeb = cvsNeb.getContext('2d');

        function resizeNeb() {
            cvsNeb.width = cvsNeb.parentElement.offsetWidth;
            cvsNeb.height = cvsNeb.parentElement.offsetHeight;
        }
        resizeNeb();

        let nebulaParticles = [];
        let hue = 0;

        cvsNeb.addEventListener('mousemove', function(e) {
             const rect = cvsNeb.getBoundingClientRect();
             const x = e.clientX - rect.left;
             const y = e.clientY - rect.top;
             for(let i=0; i<3; i++){
                 nebulaParticles.push(new NebulaParticle(x, y));
             }
        });

        class NebulaParticle {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.size = Math.random() * 15 + 1;
                this.speedX = Math.random() * 3 - 1.5;
                this.speedY = Math.random() * 3 - 1.5;
                this.color = 'hsl(' + hue + ', 100%, 50%)';
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                if (this.size > 0.2) this.size -= 0.1;
            }
            draw() {
                ctxNeb.fillStyle = this.color;
                ctxNeb.beginPath();
                ctxNeb.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctxNeb.fill();
            }
        }

        function animateNeb() {
            ctxNeb.fillStyle = 'rgba(0,0,0,0.1)';
            ctxNeb.fillRect(0,0, cvsNeb.width, cvsNeb.height);

            ctxNeb.globalCompositeOperation = 'lighter';

            for(let i=0; i<nebulaParticles.length; i++) {
                nebulaParticles[i].update();
                nebulaParticles[i].draw();
                if(nebulaParticles[i].size <= 0.3) {
                    nebulaParticles.splice(i, 1);
                    i--;
                }
            }
            ctxNeb.globalCompositeOperation = 'source-over';
            hue += 2;
            requestAnimationFrame(animateNeb);
        }
        animateNeb();

        // =========================================================
        // CONFIGURACIÓN GLOBAL (RESIZE)
        // =========================================================
        window.addEventListener('resize', () => {
            resizeSphere();
            resizeFire();
            resizeNeb();
        });

        // El código del tema oscuro se ha eliminado completamente.
    </script>
</body>
</html>